file(GLOB_RECURSE MODULE_SRC *.cpp *.hpp)

if(DEFINED PY_VERSION_INFO)
    pybind11_add_module(ntgcalls ${MODULE_SRC})
    target_compile_definitions(ntgcalls PRIVATE VERSION_INFO=${PY_VERSION_INFO})
else()
    list(REMOVE_ITEM MODULE_SRC "${CMAKE_CURRENT_SOURCE_DIR}/pythonapi.cpp")
    add_executable(ntgcalls ${MODULE_SRC})
endif()
if(WIN32)
    set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} /MT /GR-")
    set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} /MTd /GR- -D_HAS_ITERATOR_DEBUGGING=0")
    set(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} /FORCE:UNRESOLVED")
endif()

set_property(TARGET ntgcalls PROPERTY CXX_STANDARD 20)
set_target_properties(ntgcalls PROPERTIES EXPORT_NAME ntgcalls)
target_link_libraries(ntgcalls PRIVATE wrtc nlohmann_json::nlohmann_json)